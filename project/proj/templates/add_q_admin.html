{% extends 'main.html' %}

{% block title %}
    Задать вопрос
{% endblock %}


{% block content %}
    <h1>Задать вопрос</h1>
    <div id="message">
        <p>
            {% if mess %}
                {{ mess }}
            {% endif %}
        </p>
    </div>
    <div id='question' class='borderLine'>
        <form action="{% url add_q %}" method="POST">{% csrf_token %}
            <table id='tableForm'>
                {{ form.as_table }}
            </table>
            <input type="submit" value="Создать вопрос" />
        </form>
    </div>
{% endblock %}

{% block script %}
    <script>
        function CountObjectProperty(data)
        {
            var count = 0;
            for (var foo in data) {
                if(data.hasOwnProperty(foo))
                {
                    count++;
                }
            }
            return count;
        }
        function OnchangeUserTo()
        {
            $('#id_user_to').change(function(){
                GetPostForUserTo();
            });
        }
        function GetPostForUserTo()
        {
            var select_post = $('#id_post');
            var loading = $('#loading');
            var value_user_to = $('#id_user_to').val();
            var message = $('#message p');
            loading.fadeIn();
            select_post.fadeOut();
            select_post.empty();
            select_post.removeAttr('disabled');
            select_post.append('<option value="" selected="selected">---------</option>');
            if(value_user_to)
            {
                $.ajax({
                    url : '/ajax/get_posts_for_add_ques/'+value_user_to+'/',
                    type: 'GET',
                    dataType: 'json',
                    success: function(data){
                        var counter = CountObjectProperty(data);
                        if(counter != 0){
                            $.each(data, function(id, value){
                                select_post.append('<option value="'+id+'" >'+value+'</option>');
                            });
                        }else{
                            message.append('Для данного полльзователя нет должностей');
                            message.fadeIn();
                        }
                        select_post.fadeIn();
                        loading.fadeOut();
                    }
                });
            }else{
                select_post.attr('disabled',"disabled");
                select_post.fadeIn();
                loading.fadeOut();
            }
        }
    function GetCompanyTo(){
        $('#loading').fadeIn();
                    $.ajax({
                        url: '/ajax/get_company_to/',
                        dataType: 'html',
                        type:'GET'
                    }).done(function(data){
                                $('#id_user_to').append(data).fadeIn();
                                $('#loading').fadeOut();
              });
    }
    function GetUserTo(){
        $('#loading').fadeIn();
        $('#id_user_to').hide();
        $.ajax({
            url: '/ajax/get_user_to/',
            dataType: 'html',
            type:'GET'
        }).done(function(data){
                    $('#id_user_to').empty().append(data);
                }).done(function(){
                    GetCompanyTo();
                    $('#loading').fadeOut();
                });
    }
    function ChangeForAllCheckBox(){
        $('#id_for_all').click(function(){
            if(this.checked){
                $('#id_user_to').attr("disabled","disabled");
                $('#id_user_to').val('0');
            }else{
                $('#id_user_to').removeAttr("disabled");
            }
        });
    }
    function CheckBoxForAll(){
        var value = $('#id_for_all').prop("checked");
        if(value){
            $('#id_user_to').attr("disabled","disabled");
            $('#id_user_to').val('0');
        }else{
            $('#id_user_to').removeAttr("disabled");
        }
    }
    $(document).ready(function(){
        GetUserTo();
        ChangeForAllCheckBox();
        CheckBoxForAll();
        OnchangeUserTo();
    });
    </script>
{% endblock %}