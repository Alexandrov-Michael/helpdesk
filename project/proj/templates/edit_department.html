{% extends 'main.html' %}

{% block title %}
    Изменить отдел
{% endblock %}

{% block content %}
    <h1>Изменение отдела в компании</h1>
    <div id="message"><p></p></div>
    <div id='question' class='borderLine'>
        <form action="{% url edit_dep object.pk %}" method="POST">{% csrf_token %}
            <table id='tableForm'>
                {{ form.as_table }}
            </table>
            <input type="submit" value="Изменить" />
        </form>
    </div>
{% endblock %}

{% block script %}
    <script type="text/javascript">

        var start = true;

        function CountObjectProperty(data)
        {
            var count = 0;
            for (var foo in data) {
                if(data.hasOwnProperty(foo))
                {
                    count++;
                }
            }
            return count;
        }
        function GetCompany()
        {
            var loading =  $('#loading');
            var select = $('#id_company');
            var message = $('#message p');
            loading.fadeIn();
            select.fadeOut();
            message.fadeOut();
            message.empty();
            $.ajax({
                url: '/ajax/get_company_for_add_dep/',
                type: 'GET',
                dataType: 'json',
                success: function(jsonData){
                    select.empty();
                    var option0 = '<option selected="selected" value="">---------</option>';
                    select.append(option0);
                    var counter = CountObjectProperty(jsonData);
                    if(counter != 0){
                        $.each(jsonData, function(id, value){
                            select.append(GetSelectHtml(value));
                        });
                    }else{
                        message.append('Вы не обслуживаете ни одну компанию')
                        message.fadeIn();
                    }
                    if(start)
                    {
                        GetDefaultCompanyToFromGET();
                        start = false;
                    }
                    select.fadeIn();
                    loading.fadeOut();
                }
            })
        }
        function GetSelectHtml(value)
        {
            var id = value["id"];
            var name = value["name"];
            return '<option value="'+id+'">'+name+'</option>';
        }
        function getUrlVars()
        {
            var vars = [], hash;
            var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
            for(var i = 0; i < hashes.length; i++)
            {
                hash = hashes[i].split('=');
                vars.push(hash[0]);
                vars[hash[0]] = hash[1];
            }
            return vars;
        }
        function GetDefaultCompanyToFromGET(){
            var objToGet = getUrlVars()['company'];
            if(objToGet)
            {
                $("#id_company").val(objToGet);
            }
        }
        $(document).ready(function(){
            GetCompany();
        });
    </script>
{% endblock %}